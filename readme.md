# Node.js LDAP驗證程式
## 安裝前確認工作
1. 你的node是否在9以上
2. LDAP主機是否可以存取
3. NPM中需要的模組裝了沒（7-13行）
## ADservers.json
如果要新增別的AD主機，請仿照已經有的格式，請注意主機和主機之間要用,區隔（只剩一台主機的話就不需要逗點了）
suffix請到AD管理員去看，假設登入帳號為kkk\aaaaa，有可能就是kkk.local，不過還是到系統管理工具＼AD管理員去看比較準確
## IPrules.json
這是IP管控檔案，目前許可以下幾台機器可以連線：
1. 127.0.0.1
2. 192.168.0.0 - 192.168.255.255
3. 10.0.0.0 - 10.0.255.255
如果還需要許可其他的主機， [有網站可以幫忙](http://www.analyticsmarket.com/freetools/ipregex) ，輸入你要的IP範圍，複製下來該網站產生的規格
由於這是用regular expression去比對，請務必記得要在\前面多補一個\，例如： ` ^127\.0\.0\.1$ ` 是不可以的，要寫成 ` ^127\\.0\\.0\\.1$ `
如果要檢測你寫的regular expression是否正確，可以到 [線上測試器](https://regex101.com/) ，自己測試看看
## 記錄檔
1. 記錄檔全部存在資料庫裏面，用任何的SQLite管理器，例如 [DB Browser for SQLite](http://sqlitebrowser.org/) ，檢視資料切換到Browse Data標籤（如果要更新即時的錯誤，按F5）
2. 請注意時間欄位用的是unix timestamp，可以先查看線上及時 [timestamp](https://www.epochconverter.com/)
3. 登入失敗的紀錄資料庫管理員可能無法顯示，真的要看的話要匯出成TXT（Browse Data右側有一個Mode按鈕，隔壁就是匯出）
## 測試網址
1. 預設測試網址是 **http://localhost:1234/LDAPAuth?userID=帳號&userPass=密碼**
2. 如果要修改Port，請到94行修改，如果要改存取位置（預設為LDAPAuth），請到118行修改
3. 如果要修改參數，如userID要改成別的，請到124、125行修改
4. 如果要啟動HTTPS，請自己查node的HTTPS要怎麼處理
## 預設內容，如果玩壞的話，就從這裡複製（GitHub中沒有，請自行建立）
1. ADservers.json
    ```
    [
        { "server": "第一台主機","port": 389 , "suffix": "該主機的名稱，例如xxx.local" },
        { "server": "第二台主機","port": 389 , "suffix": "沒有第二台主機，就刪掉這一行（記得主機和主機間要用逗點隔開）" }
    ]
    ```
2. IPrules.json
    ```
    [
        "^192\\.168\\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))\\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))$",
        "^10\\.0\\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))\\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))$",
        "^127\\.0\\.0\\.1$"
    ]
    ```